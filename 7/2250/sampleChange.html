<link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>

    &#47&#47 select those non-empty test cases
    all_exp_names = [k.replace(&quottest_&quot, &quot&quot) for k, v in vars(args).items() if k.startswith(&quottest_&quot) and v]
    <a id="change">fw = open(&quotbenchmark-%d%s.result&quot % (args.num_worker, &quot-fp16&quot if args.fp16 else &quot&quot), &quotw&quot)</a>
    for exp_name in all_exp_names:
        &#47&#47 set common args
        cargs = deepcopy(args)
        exp_vars = vars(args)[&quottest_%s&quot % exp_name]
        avg_speed = []

        for cvar in exp_vars:
            &#47&#47 override exp args
            setattr(cargs, exp_name, cvar)
            server = BertServer(cargs)
            server.start()
            time.sleep(cargs.wait_till_ready)

            &#47&#47 sleep until server is ready
            all_clients = [BenchmarkClient(cargs, vocab) for _ in range(cargs.num_client)]
            for bc in all_clients:
                bc.start()

            clients_speed = []
            for bc in all_clients:
                bc.join()
                clients_speed.append(cargs.client_batch_size / bc.avg_time)
            server.close()

            max_speed, min_speed, cavg_speed = int(max(clients_speed)), int(min(clients_speed)), int(
                mean(clients_speed))

            print(&quotavg speed: %d\tmax speed: %d\tmin speed: %d&quot % (cavg_speed, max_speed, min_speed), flush=True)

            avg_speed.append(cavg_speed)

        print(&quot\n|`%s`\t|samples/s|\n|---|---|&quot % exp_name, file=fw)
        for cvar, cavg_speed in zip(exp_vars, avg_speed):
            print(&quot|%s\t|%d|&quot % (cvar, cavg_speed), file=fw)
        &#47&#47 for additional plotting
        print(&quot\n%s = %s\n%s = %s&quot % (exp_name, exp_vars, &quotspeed&quot, avg_speed), file=fw)
    <a id="change">fw.close()</a>
</code></pre><h3>After Change</h3><pre><code class='java'>

            avg_speed.append(cavg_speed)

        <a id="change">with open(&quotbenchmark-%d%s.result&quot % (args.num_worker, &quot-fp16&quot if args.fp16 else &quot&quot), &quota&quot) as fw:
            print(&quot\n|`%s`\t|samples/s|\n|---|---|&quot % exp_name, file=fw)
            for cvar, cavg_speed in zip(exp_vars, avg_speed):
                print(&quot|%s\t|%d|&quot % (cvar, cavg_speed), file=fw)
            &#47&#47 for additional plotting
            print(&quot\n%s = %s\n%s = %s&quot % (exp_name, exp_vars, &quotspeed&quot, avg_speed), file=fw)</a>
</code></pre>