<link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
    entropy = tf.nn.sparse_softmax_cross_entropy_with_logits(
        logits=prediction, labels=ground_truth)
    if weight_map is not None:
        weight_map = <a id="change">tf.cast(tf.size(entropy), dtype=tf.float32)</a> / \
                     tf.reduce_sum(weight_map) * weight_map
        <a id="change">entropy = tf.multiply(entropy, weight_map)</a>
    return tf.reduce_mean(entropy)


def cross_entropy_dense(prediction, ground_truth, weight_map=None):</code></pre><h3>After Change</h3><pre><code class='java'>
    entropy = tf.nn.sparse_softmax_cross_entropy_with_logits(
        logits=prediction, labels=ground_truth)

    <a id="change">if weight_map is None:
        return tf.reduce_mean(entropy)

   </a> weight_sum = tf.maximum(tf.reduce_sum(weight_map), 1e-6)
    <a id="change">return tf.reduce_sum(entropy * weight_map / weight_sum)</a>


def cross_entropy_dense(prediction, ground_truth, weight_map=None):
    if weight_map is not None:</code></pre>