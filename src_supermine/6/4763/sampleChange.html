<link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
        idx_tensor = tf.constant(idx_list)

        _, idx = tf.math.top_k(dist_tensor, k=n)
        <a id="change">return tf.gather(idx_tensor, idx)</a>

    def _get_distance_sum(self, weight, in_idx, out_idx):
        w = tf.reshape(weight, (-1, weight.shape[-2], weight.shape[-1]))
        anchor_w = tf.tile(tf.expand_dims(weight[in_idx, out_idx], 0), [w.shape[0], 1, 1])</code></pre><h3>After Change</h3><pre><code class='java'>
        assert len(weight.shape) &gt;= 3
        assert weight.shape[0] * weight.shape[1] &gt; 2

        <a id="change">dist_list = []</a>
        for in_i in range(weight.shape[0]):
            for out_i in range(weight.shape[1]):
                dist_sum = self._get_distance_sum(weight, in_i, out_i)
                dist_list.append((dist_sum, (in_i, out_i)))
        <a id="change">min_gm_kernels = sorted(dist_list, key=lambda x: x[0])[:n]</a>
        <a id="change">return [x[1] for x in min_gm_kernels]</a>

    def _get_distance_sum(self, weight, in_idx, out_idx):
        w = tf.reshape(weight, (-1, weight.shape[-2], weight.shape[-1]))
        anchor_w = tf.tile(tf.expand_dims(weight[in_idx, out_idx], 0), [w.shape[0], 1, 1])</code></pre>