<html><h3>1c0a56060278fa9c0601e4d5eceeff39573a05a9,niftynet/engine/sampler_weighted.py,,weighted_spatial_coordinates,#Any#Any#Any#Any#Any#,46
</h3><link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
    smaller window sizes (the output windows are concentric).
    
    if data is None or data.get(&quotsampler&quot, None) is None:
        <a id="change">raise tf.logging.fatal("input weight map not found. please check"
                               "the configuration file")</a>
    n_samples = max(n_samples, 1)
    uniq_spatial_size = set([img_size[:N_SPATIAL]
                             for img_size in list(img_sizes.values())])
    if len(uniq_spatial_size) &gt; 1:</code></pre><h3>After Change</h3><pre><code class='java'>
    &#47&#47 the window might be. If the centre of the window was outside of
    &#47&#47 this crop area, the patch would be outside of the field of view
    half_win = np.floor(max_spatial_win / 2).astype(int)
    <a id="change">try:
        cropped_map = data[&quotsampler&quot][
            half_win[0]:-half_win[0] if max_spatial_win[0] &gt; 1 else 1,
            half_win[1]:-half_win[1] if max_spatial_win[1] &gt; 1 else 1,
            half_win[2]:-half_win[2] if max_spatial_win[2] &gt; 1 else 1,
            0, 0]
        assert np.all(cropped_map.shape) &gt; 0
    except (IndexError, KeyError):
        tf.logging.fatal("incompatible map: %s", data[&quotsampler&quot].shape)
        raise
    except AssertionError:
        tf.logging.fatal(
            "incompatible window size for weighted sampler. "
            "Please use smaller (fully-specified) spatial window sizes")
        raise
    &#47&#47 Get the cumulative sum of the normalised sorted intensities
    &#47&#47 i.e. first sort the sampling frequencies, normalise them
    &#47&#47 to sum to one, and then accumulate them in order
   </a> flatten_map = cropped_map.flatten()
    sorted_data = np.cumsum(np.divide(np.sort(flatten_map), flatten_map.sum()))
    &#47&#47 get the sorting indexes to that we can invert the sorting later on.
    sorted_indexes = np.argsort(flatten_map)</code></pre><img src="5640444.png" alt="Italian Trulli"   style="width:500px;height:500px;"><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 3</div><BR><div id='size'>Non-data size: 5</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/NifTK/NiftyNet/commit/1c0a56060278fa9c0601e4d5eceeff39573a05a9#diff-a23e32c67b379ba75a636c889086f1683d15e83d1fe06b408a41f2b87a20b78eL66' target='_blank'>Link</a></div><div id='project'> Project Name: NifTK/NiftyNet</div><div id='commit'> Commit Name: 1c0a56060278fa9c0601e4d5eceeff39573a05a9</div><div id='time'> Time: 2017-10-03</div><div id='author'> Author: wenqi.li@ucl.ac.uk</div><div id='file'> File Name: niftynet/engine/sampler_weighted.py</div><div id='class'> Class Name: </div><div id='method'> Method Name: weighted_spatial_coordinates</div><BR><BR><div id='link'><a href='https://github.com/NifTK/NiftyNet/commit/165207a79dafcf658f483d26ccffd9e982389dcc#diff-6072c4b96c67804b8bf443b3ef36d3ebfc3f3bfe34234ef9c0f681e5527d6039L80' target='_blank'>Link</a></div><div id='project'> Project Name: NifTK/NiftyNet</div><div id='commit'> Commit Name: 165207a79dafcf658f483d26ccffd9e982389dcc</div><div id='time'> Time: 2018-05-01</div><div id='author'> Author: wenqi.li@ucl.ac.uk</div><div id='file'> File Name: niftynet/io/image_reader.py</div><div id='class'> Class Name: ImageReader</div><div id='method'> Method Name: initialise</div><BR><BR><div id='link'><a href='https://github.com/NifTK/NiftyNet/commit/9db50ab9ed6bf6b4e462c84e2c38fedd36e7467a#diff-2cf0483ad33e6f2cf004bb877e90062038ede4ebb20c6288e008cb83171ac9eaL165' target='_blank'>Link</a></div><div id='project'> Project Name: NifTK/NiftyNet</div><div id='commit'> Commit Name: 9db50ab9ed6bf6b4e462c84e2c38fedd36e7467a</div><div id='time'> Time: 2017-11-08</div><div id='author'> Author: wenqi.li@ucl.ac.uk</div><div id='file'> File Name: niftynet/io/image_sets_partitioner.py</div><div id='class'> Class Name: ImageSetsPartitioner</div><div id='method'> Method Name: randomly_split_dataset</div><BR>