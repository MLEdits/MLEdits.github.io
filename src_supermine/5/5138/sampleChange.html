<link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
            new_queue = asyncio.Queue()

            while not old_queue.empty():
                <a id="change">curr_tag = await old_queue.get()</a>
                if curr_tag != backend_replica_tag:
                    await new_queue.put(curr_tag)

            self.worker_queues[backend_tag] = new_queue</code></pre><h3>After Change</h3><pre><code class='java'>
        async with self.flush_lock:
            del self.replicas[backend_replica_tag]

            <a id="change">try:
                self.worker_queues[backend_tag].remove(backend_replica_tag)
            except ValueError:
                &#47&#47 Replica doesn&quott exist in the idle worker queues.
                &#47&#47 It&quots ok because the worker might not have returned the
                &#47&#47 result.
                pass

   </a> async def set_traffic(self, endpoint, traffic_dict):
        logger.debug("Setting traffic for endpoint %s to %s", endpoint,
                     traffic_dict)
        async with self.flush_lock:</code></pre>