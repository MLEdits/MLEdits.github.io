<html><h3>184277b5d9a4658eb326d8f679618284299554a2,debug_toolbar/views.py,,sql_profile,#,85
</h3><link rel="stylesheet" href="../default.css">
<script src="../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
    hash = sha_constructor(settings.SECRET_KEY + sql + params).hexdigest()
    if hash != request.GET.get('hash', ''):
        return HttpResponseBadRequest('Tamper alert') # SQL Tampering alert
    if <a id="change">sql</a>.lower().startswith('select'):
        params = simplejson.loads(params)
        cursor = connection.cursor()
        cursor.execute("SET PROFILING=1") # Enable profiling</code></pre><h3>After Change</h3><pre><code class='java'>
    hash = sha_constructor(settings.SECRET_KEY + sql + params).hexdigest()
    if hash != request.GET.get('hash', ''):
        return HttpResponseBadRequest('Tamper alert') # SQL Tampering alert
    if <a id="change">sql</a>.lower().strip().startswith('select'):
        params = simplejson.loads(params)
        cursor = connection.cursor()
        cursor.execute("SET PROFILING=1") # Enable profiling
        cursor.execute(sql, params) # Execute SELECT
        cursor.execute("SET PROFILING=0") # Disable profiling
        # The Query ID should always be 1 here but I'll subselect to get the last one just in case...
        cursor.execute("SELECT * FROM information_schema.profiling WHERE query_id=(SELECT query_id FROM information_schema.profiling ORDER BY query_id DESC LIMIT 1)")
        headers = [d[0] for d in cursor.description]
        result = cursor.fetchall()
        cursor.close()
        context = {
            'result': result,
            'sql': reformat_sql(cursor.db.ops.last_executed_query(cursor, sql, params)),
            'time': request.GET.get('time', 0.0),
            'headers': headers,
        }
        return render_to_response('debug_toolbar/panels/sql_explain.html', context)
    <a id="change">raise InvalidSQLError("Only 'select' queries are allowed.")</a>

def template_source(request):
    """
    Return the source of a template, syntax-highlighted by Pygments if</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 3</div><BR><div id='size'>Non-data size: 5</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/jazzband/django-debug-toolbar/commit/184277b5d9a4658eb326d8f679618284299554a2#diff-b5e824a73cdcc7c9e616cfc8237b67792ad3eb098691872bf1833ae06f314782L85' target='_blank'>Link</a></div><div id='time'> Time: 2009-01-17</div><div id='author'> Author: aeby@atizo.com</div><div id='method'> File Name: debug_toolbar/views.py</div><div id='class'> Class Name: </div><div id='method'> Method Name: sql_profile</div><BR><BR><div id='link'><a href='https://github.com/jazzband/django-debug-toolbar/commit/184277b5d9a4658eb326d8f679618284299554a2#diff-b5e824a73cdcc7c9e616cfc8237b67792ad3eb098691872bf1833ae06f314782L23' target='_blank'>Link</a></div><div id='time'> Time: 2009-01-17</div><div id='author'> Author: aeby@atizo.com</div><div id='method'> File Name: debug_toolbar/views.py</div><div id='class'> Class Name: </div><div id='method'> Method Name: sql_select</div><BR><BR><div id='link'><a href='https://github.com/jazzband/django-debug-toolbar/commit/184277b5d9a4658eb326d8f679618284299554a2#diff-b5e824a73cdcc7c9e616cfc8237b67792ad3eb098691872bf1833ae06f314782L54' target='_blank'>Link</a></div><div id='time'> Time: 2009-01-17</div><div id='author'> Author: aeby@atizo.com</div><div id='method'> File Name: debug_toolbar/views.py</div><div id='class'> Class Name: </div><div id='method'> Method Name: sql_explain</div><BR>