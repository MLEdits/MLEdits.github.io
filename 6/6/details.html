<html><h3>184277b5d9a4658eb326d8f679618284299554a2,debug_toolbar/views.py,,sql_explain,#,54
</h3><link rel="stylesheet" href="../../default.css">
<script src="../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3></h3><h3>Before Change</h3><pre><code class='java'>
    hash = sha_constructor(settings.SECRET_KEY + sql + params).hexdigest()
    if hash != request.GET.get('hash', ''):
        return HttpResponseBadRequest('Tamper alert') # SQL Tampering alert
    if <a id="change">sql</a>.lower().startswith('select'):
        params = simplejson.loads(params)
        cursor = connection.cursor()
        cursor.execute("EXPLAIN %s" % (sql,), params)</code></pre><h3>After Change</h3><pre><code class='java'>
    hash = sha_constructor(settings.SECRET_KEY + sql + params).hexdigest()
    if hash != request.GET.get('hash', ''):
        return HttpResponseBadRequest('Tamper alert') # SQL Tampering alert
    if <a id="change">sql</a>.lower().strip().startswith('select'):
        params = simplejson.loads(params)
        cursor = connection.cursor()
        cursor.execute("EXPLAIN %s" % (sql,), params)
        headers = [d[0] for d in cursor.description]
        result = cursor.fetchall()
        cursor.close()
        context = {
            'result': result,
            'sql': reformat_sql(cursor.db.ops.last_executed_query(cursor, sql, params)),
            'time': request.GET.get('time', 0.0),
            'headers': headers,
        }
        return render_to_response('debug_toolbar/panels/sql_explain.html', context)
    <a id="change">raise InvalidSQLError("Only 'select' queries are allowed.")</a>

def sql_profile(request):
    """
    Returns the output of running the SQL and getting the profiling statistics.</code></pre><div id='inPattern'>In pattern: SUPERPATTERN</div><BR><div id='frequency'>Frequency: 3</div><BR><div id='size'>Non-data size: 5</div><BR><h3>Instances</h3><BR><div id='link'><a href='https://github.com/jazzband/django-debug-toolbar/commit/184277b5d9a4658eb326d8f679618284299554a2#diff-b5e824a73cdcc7c9e616cfc8237b67792ad3eb098691872bf1833ae06f314782L70' target='_blank'>Link</a></div><div id='project'> Project Name: jazzband/django-debug-toolbar</div><div id='commit'> Commit Name: 184277b5d9a4658eb326d8f679618284299554a2</div><div id='time'> Time: 2009-01-17</div><div id='author'> Author: aeby@atizo.com</div><div id='file'> File Name: debug_toolbar/views.py</div><div id='class'> Class Name: </div><div id='method'> Method Name: sql_explain</div><BR><BR><div id='link'><a href='https://github.com/jazzband/django-debug-toolbar/commit/184277b5d9a4658eb326d8f679618284299554a2#diff-b5e824a73cdcc7c9e616cfc8237b67792ad3eb098691872bf1833ae06f314782L70' target='_blank'>Link</a></div><div id='project'> Project Name: jazzband/django-debug-toolbar</div><div id='commit'> Commit Name: 184277b5d9a4658eb326d8f679618284299554a2</div><div id='time'> Time: 2009-01-17</div><div id='author'> Author: aeby@atizo.com</div><div id='file'> File Name: debug_toolbar/views.py</div><div id='class'> Class Name: </div><div id='method'> Method Name: sql_select</div><BR><BR><div id='link'><a href='https://github.com/jazzband/django-debug-toolbar/commit/184277b5d9a4658eb326d8f679618284299554a2#diff-b5e824a73cdcc7c9e616cfc8237b67792ad3eb098691872bf1833ae06f314782L70' target='_blank'>Link</a></div><div id='project'> Project Name: jazzband/django-debug-toolbar</div><div id='commit'> Commit Name: 184277b5d9a4658eb326d8f679618284299554a2</div><div id='time'> Time: 2009-01-17</div><div id='author'> Author: aeby@atizo.com</div><div id='file'> File Name: debug_toolbar/views.py</div><div id='class'> Class Name: </div><div id='method'> Method Name: sql_profile</div><BR>